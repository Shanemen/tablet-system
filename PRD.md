# **淨土道場牌位系統 - PRD**

[**淨土道場牌位系統｜架構規劃（純 Supabase）**](https://www.notion.so/Supabase-2933cd8a07dc80419f20c737ec225e17?pvs=21)

## 🎯 项目核心目标

为佛教道场开发一个**线上牌位申请和批量生成系统**，支持：

- 信众在线申请（中英双语，后期会再加入越南语）
- 管理员批量生成牌位（支持10000+）
- 按类型导出6个PDF文件供打印

## **用戶端功能**

### **法會信息展示- P0 - 必須 (MVP)**

在申請表單頂部展示當前法會的完整信息

- 表單頂部類似 Google Form header，顯示法會信息
    - 包含：法會名稱、日期時間、地點、申请截止日期
    - 顯著提示：「申請截止日期：YYYY-MM-DD」
    - 截止日期過後自動關閉（前端實時檢查，無需定時任務）
    - 關閉後的表單顯示「申請已截止」，不能提交
- 每個法會有唯一 URL，可分享連結或二維碼

### **用戶登錄- P0 - 必須 (MVP)**

用戶通過個人信息建立帳戶並且查看申請記錄

- 驗證字段：
  - 姓名（與申請時一致）
  - 出生年份（4位數字，如：1955）
  - 出生日（1-31，不收集月份）
  - 電話後四位
  - 驗證碼（防機器人）

說明：不收集完整生日，只收集日期數字（1-31）

安全措施：
  - 2790萬種組合
  - 同IP：5分鐘內最多3次
  - 同電話：3次失敗鎖定10分鐘
  - 驗證碼5分鐘過期
  - 訪問日誌和異常監控

隱私保護：
  - 不存儲完整生日
  - 降低個人信息敏感度
  - 符合隱私法規要求

### **基本申請表單- P0 - 必須 (MVP)**

信眾填寫申請人信息、牌位類型、名字等基本信息

- 申請人姓名、電話（必填）
- 牌位類型選擇（超薦/祈福）
    - 具体有六个种类：长生禄位，往生蓮位，歷代祖先，冤親債主，墮胎嬰靈，地基主
- 牌位名字輸入（支持填写多個，比如一次申请三个往生蓮位）
- 清晰的字段說明（用白話文，避免專業術語造成初學者的誤解）

### **表單驗證 P0 - 必須 (MVP)**

確保必填項完整，提供清晰的錯誤提示和字數限制

- 必填項檢查：姓名、電話不能為空
- 缺少必填項時顯示具體錯誤信息
- 每種牌位類型顯示填寫示例或提示說明
- 名字字數限制（確保能顯示在牌位上）：
    - 中文名字：8個字以下
        - edge cases：上弘下唯法師，买买提江·熱合曼
    - 英文名字：最多30個字符（僅 First + Last Name）e.g. Alexandra Christensen-Smith
    - 超過限制時無法再輸入
- 提交前檢查：缺少必填項時禁用提交按鈕並且彈出提示

### **提交確認- P0 - 必須 (MVP)**

提交成功後顯示申請編號和純文字預覽

- 顯示申請編號（唯一識別碼）
- 顯示提交時間
- 提交成功反饋：「提交成功」
- 純文字預覽：顯示排位上的信息，比如"佛力超薦，某某某，往生淨土"

### **多語言支持- 重要P2**

表單首選語言選擇，全程單一語言顯示

- 表單第一題：「Preferred Language / 首選語言」（中文/English）
- 用戶選擇語言後，整個表單只顯示該語言
- 不需要切換按鈕（選定後不可更改，避免混淆）
- 後端保存用戶語言偏好
- 使用 i18n 框架（如 react-i18next），便於後期添加越南文

### **提交後圖片預覽- 次要P3**

提交成功後即時生成簡版牌位圖片供信眾預覽

- 簡化版牌位圖片生成（黃色背景+黑色文字）
- 顯示在確認頁面
- 提供下載選項
- 提示這是預覽版，正式版由管理員生成

---

## **管理員功能**

### 核心目標

- 高效查看和管理大量申請（支持1000+申請）
- 批量處理：一鍵生成10000+牌位
- 按6種牌位類型自動分組導出PDF

### 用戶角色

- **管理員**：道場工作人員，負責審核申請、批量生成牌位、處理問題申請

### **管理員登入- P0 - 必須 (MVP)**

安全的登入系統，登录后保持登录状态

- 登入頁面（用戶名 + 密碼）
- 密碼加密存儲（bcrypt 或類似方案）
- 登錄後保持登錄狀態（使用 JWT Token 或 Session）
- 自動登出：30分鐘無操作自動登出
- 「記住我」選項（可選）：7天內免登錄

### **申請列表查看- P0 - 必須 (MVP)**

查看所有申請，包含状态和法会筛选、搜索功能

- 表格顯示申請列表（申請編號、姓名、牌位類型、法會、狀態、提交時間）
- 按狀態篩選：牌位總數/ 待處理 / 已生成牌位 / 有問題
    - 數據關係：待處理(waiting to be processed) + 已生成牌位(exported to PDFs) + 有問題 (problematic)= 牌位總數（all tablets)
- 按法會日期篩選：選擇特定法會查看該場法會的所有申請
- 搜索功能：按姓名或電話搜索
- 列表排序：按提交時間排序（最新在前）

### 搜索功能

**永久顯示**，位於頁面頂部

- placeholder: "🔍 搜索申請人姓名、電話或牌位上親友名字..."
- 輸入行為：實時更新 searchQuery state
    - 不自動觸發搜索（需點擊按鈕或按Enter）
    - onKeyPress: 如果按下 Enter 鍵 → 執行搜索
    - onClick (清除按鈕): 清空輸入框， 清除搜索狀態， 返回之前的視圖
- Search results：只顯示匹配的申請

### UI組件

### **申請詳情和編輯- P0 - 必須 (MVP)**

查看完整申請信息，支持修改和簡單狀態標記

- 詳情頁面：顯示所有申請信息:牌位總數/ 待處理 / 已生成牌位 / 有問題
- 編輯功能：管理員可直接修改任何字段
- 保存修改按鈕
- 簡單狀態標記：可標記為「有問題」，方便日後查找
- 標記有問題時可添加備註（如：「名字可能寫反」）
- 不需要自動通知功能（主辦方自行聯繫申請人）
- tabs卡片功能對應關係
    - 全部- All， 列表顯示：所以申請，是否顯示批量處理：否
    - 已導出- Exported， 列表顯示：只顯示已導出的申請，是否顯示批量處理：否
    - **待處理-Pending，列表顯示：只顯示待處理的申請，是否顯示批量處理：是！**
    - 有問題- Problematic， 列表顯示：只顯示有問題的申請，是否顯示批量處理：否

### 批量導出

選擇要導出的申請：前100個，或全部，具體數字待定，取決於系統的processing power不卡

- 顯示批量導出的信息：
    - 已選擇申請：X **份** 總牌位數：Y
    - 自動處理規則：
        - 按6種牌位類型自動分組
        - 同類型牌位按申請人姓名拼音排序
    - 每頁排版 6-8 個牌位，自動分頁
        - **將生成以下文件：**
            
            1. 2024-03-15_觀音法會_長生祿位.pdf(紅紙打印)
            2. 2024-03-15_觀音法會_往生蓮位.pdf(黃紙打印)
            3. 2024-03-15_觀音法會_歷代祖先.pdf(黃紙打印)
            4. 2024-03-15_觀音法會_冤親債主.pdf(黃紙打印)
            5. 2024-03-15_觀音法會_墮胎嬰靈.pdf(黃紙打印)
            6. 2024-03-15_觀音法會_地基主.pdf(黃紙打印)
            
        - 生成progress - show visual feedback
        - 已生成 - show confirmation: **生成完成！**已成功生成 6 個 PDF 文件
        - CTAs: 預覽 + 下載，或全部下載 + 關閉。

### **法會管理- P0 - 必須 (MVP)**

創建法會項目，設置法會信息和申請截止日期

- 創建新法會：輸入名稱（中英文）、日期時間、地點
- 設置申請截止日期：截止後表單自動關閉（實時檢查）
- 每個法會生成唯一連結，方便分享給信眾
- 法會列表：查看所有法會狀態
- 編輯法會信息：可修改基本信息（截止前）
- 注意：通常一次只有一個進行中的法會

---

## **牌位生成**

### **批量生成 P0- 必須 (MVP)**

按類型分組批量生成所有牌位並導出 PDF

- 篩選法會 → 批量選擇所有申請
- 一鍵生成所有牌位（支持10000+牌位）
- 自動按類型分組生成（共有六種）
- 每個類型內按申請人姓名拼音排序（陳→李→王→張）
- 同一申請人的所有牌位連續排列
- 生成進度條顯示
- 生成預覽：可查看所有生成的牌位
- 導出6個獨立PDF文件（方便分紅紙/黃紙打印）：
  1. 長生祿位.pdf（紅紙打印）
  2. 往生蓮位.pdf（黃紙打印）
  3. 歷代祖先.pdf（黃紙打印）
  4. 冤親債主.pdf（黃紙打印）
  5. 墮胎嬰靈.pdf（黃紙打印）
  6. 地基主.pdf（黃紙打印）
- 支持重新生成

### **问题标记和提取P0 - 必須 (MVP)**

在预览时标记有问题的牌位，统一处理

- 批量生成后，管理员可预览所有牌位
- 发现错误 → 一键标记为「有问题」
- 可按牌位上的名字搜索申请
- 筛选「有问题」状态，统一查看
- 有问题的牌位可单独导出，手写补充

### **多模板支持- P0 - 必須 (MVP)**

6種牌位類型使用預設背景圖片模板

- 系統預先上傳6張背景模板圖片（PNG格式）：
  - 長生祿位_模板.png
  - 往生蓮位_模板.png
  - 歷代祖先_模板.png
  - 冤親債主_模板.png
  - 墮胎嬰靈_模板.png
  - 地基主_模板.png
- 背景圖包含所有裝飾和固定文字
- 系統只需在指定位置疊加動態文字：
  - 主要名字（往生者/祈福者）
  - 申請人姓名（功德主）
- 文字位置、字體、大小由後期確認配置
- 生成黑白最終圖片

### **牌位預覽- P0 - 必須 (MVP)**

生成前預覽牌位效果

- 實時預覽
- 調整文字位置
- 確認後生成

## **系統功能**

### **數據庫設計- P0 - 必須 (MVP)P1**

設計申請、法會、管理員等數據表

- ER 圖設計
- 表結構定義
- 關係設置

### **響應式設計- P0 - 必須 (MVP)**

適配手機、平板、電腦各種屏幕

- 移動端優化
- 大字體適老化
- 觸摸友好

### **數據備份？？**

**P0 - 必須 (MVP)P1 - 重要P2 - 次要P3 - 可選**

自動每日備份數據庫

- 定時備份腳本
- 雲存儲集成

### **越南文支持- 重要P2**

添加越南文語言包

- 翻譯文案
- 語言切換擴展
- 測試調整

## **❓ 待確認問題**

- [x]  **取決於方案**
    
    ### **歷史數據管理策略**
    
    **P0 - 必須 (MVP)P1 - 重要P2 - 次要P3 - 可選**

需要與主辦方確認：法會結束後的申請數據如何處理

- 問題：法會結束後，申請數據是否需要保存？
- 背景：傳統手寫牌位在法會後會焚化，不保存
- 方案A：法會結束後刪除數據（符合傳統）
- 方案B：永久保存所有數據（便於統計和查詢）
- 方案C：法會結束後導出Excel備份，然後刪除數據庫記錄
- 影響：決定數據庫設計和系統功能（歸檔、導出等）
- 待確認人：主辦方/道場負責人

## **用户流程示例**

### 1️⃣ 管理员创建法会

```
管理员后台 → [创建新法会]
┌─────────────────────────────────┐
│ 法会名称：观音菩萨圣诞法会      │ Guanyin Dharma
│ 日期：2025-03-15                │
│ 时间：上午9:00                  │
│ 地点：净土道场大殿              │
│ 申请截止日期：2025-03-10        │
│                                 │
│ [创建法会] [取消]               │
└─────────────────────────────────┘

创建后生成唯一链接：
https://yoursite.com/apply/ceremony-12345
```

### 2️⃣ 信众看到的表单页面

**表单顶部（Header）：**

```
┌─────────────────────────────────────┐
│     观音菩萨圣诞法会                  │
│     Guanyin Bodhisattva Ceremony    │
├─────────────────────────────────────┤
│ 📅 法会日期：2025年3月15日 上午9:00  │
│ 📍 地点：净土道场大殿                │
│ ⏰ 申请截止：2025年3月10日           │
│                                     │
│ 🙏 欢迎申请牌位                      │
└─────────────────────────────────────┘

[表单内容...]
```

### 3️⃣ 截止日期过后

**表单自动关闭，显示：**

```
┌─────────────────────────────────────┐
│     观音菩萨圣诞法会                  │
│     Guanyin Bodhisattva Ceremony    │
├─────────────────────────────────────┤
│ 📅 法会日期：2025年3月15日           │
│ 📍 地点：净土道场大殿                │
│                                     │
│ ⚠️  申请已截止                       │
│                                     │
│ 本次法会的牌位申请已于 2025年3月10日  │
│ 截止。感恩您的参与。                 │
└─────────────────────────────────────┘
```

## 📝 后期需要确认的：

### 1. 文字位置（坐标）+ 繁體簡體

你会告诉我每种模板上：

- 主要名字的位置：x=?, y=?
- 申请人名字的位置：x=?, y=?

### 2. 文字样式

- 字体：什么字体？（宋体？楷体？）
- 大小：多大？
- 颜色：黑色？

### 3. 多个名字的处理

如果一个人申请了3个往生莲位：

- 生成3张独立的牌位图片
- 每张图上只有1个名字

