# ä¿®å¤é‡å®šå‘å¾ªç¯ - å®Œæ•´æ­¥éª¤

## é—®é¢˜
ç™»å‡ºåå‡ºç° `ERR_TOO_MANY_REDIRECTS (-310)` é”™è¯¯

## å·²å®Œæˆçš„ä¿®å¤
âœ… ä¿®æ”¹äº†ä¸­é—´ä»¶ï¼Œå®Œå…¨è·³è¿‡ `/admin/login` è·¯å¾„
âœ… åœ¨ç™»å½•é¡µé¢æ·»åŠ äº†å®¢æˆ·ç«¯èº«ä»½æ£€æŸ¥
âœ… ä»£ç å·²æäº¤åˆ° Git

## ğŸ”§ ä½ éœ€è¦åšçš„æ­¥éª¤ï¼ˆå›æ¥åæ‰§è¡Œï¼‰

### 1. å®Œå…¨æ¸…é™¤æµè§ˆå™¨æ•°æ®ï¼ˆéå¸¸é‡è¦ï¼ï¼‰

#### Chrome/Edge:
```
1. æ‰“å¼€å¼€å‘è€…å·¥å…· (F12 æˆ– Cmd+Option+I)
2. å³é”®ç‚¹å‡»åœ°å€æ æ—è¾¹çš„"åˆ·æ–°"æŒ‰é’®
3. é€‰æ‹©"æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"
```

æˆ–è€…ï¼š
```
1. æŒ‰ Cmd+Shift+Delete (Mac) æˆ– Ctrl+Shift+Delete (Windows)
2. æ—¶é—´èŒƒå›´ï¼šé€‰æ‹©"æ‰€æœ‰æ—¶é—´"
3. å‹¾é€‰ï¼š
   - Cookies å’Œå…¶ä»–ç½‘ç«™æ•°æ®
   - ç¼“å­˜çš„å›¾ç‰‡å’Œæ–‡ä»¶
4. ç‚¹å‡»"æ¸…é™¤æ•°æ®"
```

#### æˆ–è€…ä½¿ç”¨éšèº«çª—å£æµ‹è¯•
```
Chrome: Cmd+Shift+N (Mac) æˆ– Ctrl+Shift+N (Windows)
```

### 2. æ¸…é™¤ Next.js ç¼“å­˜
```bash
cd /Users/sicongliang/Tablet-system/tablet-system
rm -rf .next
```

### 3. é‡å¯å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

### 4. æµ‹è¯•
1. è®¿é—® http://localhost:3000/admin/login
2. åº”è¯¥èƒ½çœ‹åˆ°ç™»å½•é¡µé¢ï¼ˆä¸å†æœ‰é‡å®šå‘å¾ªç¯ï¼‰
3. ç™»å½•æµ‹è¯•
4. ç™»å‡ºæµ‹è¯•

## æŠ€æœ¯ç»†èŠ‚

### ä¿®å¤å‰çš„é—®é¢˜
```
ç™»å‡º â†’ redirect('/admin/login')
  â†“
ä¸­é—´ä»¶æ£€æŸ¥ç™»å½•é¡µé¢ â†’ å‘ç°æœ‰ session cookie
  â†“
redirect('/admin/dashboard')
  â†“
ä½† session å·²å¤±æ•ˆ â†’ redirect('/admin/login')
  â†“
æ— é™å¾ªç¯ï¼âŒ
```

### ä¿®å¤å
```
ç™»å‡º â†’ redirect('/admin/login')
  â†“
ä¸­é—´ä»¶ï¼šmatcher é…ç½®è·³è¿‡ /admin/loginï¼Œä¸æ‰§è¡Œä»»ä½•æ£€æŸ¥ âœ…
  â†“
ç™»å½•é¡µé¢æ­£å¸¸åŠ è½½
  â†“
å®¢æˆ·ç«¯ useEffect æ£€æŸ¥ï¼šsession å·²æ¸…é™¤ï¼Œåœç•™åœ¨ç™»å½•é¡µé¢ âœ…
```

## å…³é”®ä¿®æ”¹

### middleware.ts
```typescript
export const config = {
  matcher: [
    // ä¸­é—´ä»¶åªåœ¨è¿™äº›è·¯å¾„è¿è¡Œï¼ˆæ’é™¤ /admin/loginï¼‰
    '/admin/((?!login).*)',
  ],
}
```

### app/admin/login/page.tsx
```typescript
// åœ¨å®¢æˆ·ç«¯æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
useEffect(() => {
  const checkAuth = async () => {
    const supabase = createClient()
    const { data: { user } } = await supabase.auth.getUser()
    
    if (user) {
      router.push('/admin/dashboard')
    }
  }
  
  checkAuth()
}, [router])
```

---

## å¦‚æœè¿˜æœ‰é—®é¢˜

å¦‚æœæ¸…é™¤ç¼“å­˜åè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå°è¯•ï¼š
1. é‡å¯ç”µè„‘ï¼ˆæ¸…é™¤æ‰€æœ‰ç³»ç»Ÿç¼“å­˜ï¼‰
2. ä½¿ç”¨ä¸åŒçš„æµè§ˆå™¨æµ‹è¯•
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

åƒå®Œé¥­å›æ¥åæŒ‰ä¸Šé¢çš„æ­¥éª¤æ“ä½œå°±å¯ä»¥äº†ï¼ğŸœ

