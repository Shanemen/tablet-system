# Image Generation and Visual References

## 图案和文字 (Patterns and Text)

### 通用元素 (Common Elements)

每个模板都包含以下装饰元素：
- **华盖 (Canopy)**: 顶部的装饰性华盖图案
- **莲台 (Lotus)**: 底部的莲花台装饰
- **卍字边框 (Swastika Borders)**: 左右两侧各一列垂直排列的卍字符号

### 🔑 核心理解：句式结构 (Sentence Structure)

**重要概念：** 牌位上的文字是**完整的句式**，不是独立的词。

#### 句式模板 1：中间主体（逝者信息）
```
佛力超薦 [逝者关系+名字] 往生蓮位
```
- **固定部分**（SVG 模板提供）：`佛力超薦` + `往生蓮位`
- **变量部分**（代码填充）：`父親梁大新`
- **完整句子**：`佛力超薦 父親梁大新 往生蓮位`

#### 句式模板 2：左侧申请人（平辈/晚辈）
```
陽上 [申请人关系+名字] 敬薦
```
- **固定部分**（SVG 模板提供）：`陽上` + `敬薦`
- **变量部分**（代码填充）：`孝女王小小` 或 `Alice Smith`
- **完整句子**：`陽上孝女王小小敬薦` 或 `陽上 Alice Smith 敬薦`

#### 句式模板 3：左侧申请人（长辈/祖先）
```
陽上後裔 [申请人名字] 叩薦
```
- **固定部分**（SVG 模板提供）：`陽上後裔` + `叩薦`
- **变量部分**（代码填充）：`李明`
- **完整句子**：`陽上後裔 李明 叩薦`

### 文字使用规则 (Text Usage Rules)

- **"叩薦"**: 用于长辈和神灵
  - 例如：对故去的父母、祖父母辈的人
  - 例如：对地基主
  
- **"敬薦"**: 用于平辈或晚辈逝者
  - 例如：对平辈或晚辈逝去的人

---

## 六种牌位类型详细说明

### 1. 长生禄位 (Longevity Tablet) - 最特殊

**特点：**
- ✅ **不需要填写"阳上"行**（因为是给活人立的）
- ✅ **用红色纸打印**（其他所有牌位都用黄纸打印）

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件（`long-living-template-optimized.svg`）中**已经预先绘制了**：
- ✅ 顶部文字：**"佛光注照"**（无需代码再次渲染）
- ✅ 底部文字：**"長生祿位"**（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**再渲染"佛光注照"
- ❌ **不要**再渲染"長生祿位"  
- ✅ **只需**在中间位置叠加用户输入的名字
  - 格式：`"某某某"` 或 `"某某某 阖家"` 或 `"ALICE SMITH"`

**实现方式：**
1. 加载 SVG 作为背景图
2. 在 SVG 上方叠加一层，仅渲染中间的名字
3. 名字规格：46px，line-height 44px，竖排居中

**示例（最终效果）：**
```
佛光注照        ← SVG 模板中已有
  某某某        ← 代码动态添加
長生祿位        ← SVG 模板中已有
```

---

### 2. 往生莲位 (Deceased Tablet)

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件中**已经预先绘制了**：
- ✅ 顶部文字：**"佛力超薦"**（无需代码再次渲染）
- ✅ 底部文字：**"往生蓮位"**（无需代码再次渲染）
- ✅ **左侧**文字：**"陽上"**（上方）+ 空白 + **"敬薦"**（下方）（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**再渲染"佛力超薦"、"往生蓮位"、"陽上"、"敬薦"
- ✅ **只需**在中间位置叠加：申请人填写的"关系-名字"
  - 例如：`"父亲王大明"`（单个逝者）
  - 例如：`"父亲王大明\n母亲李小花"`（多个逝者，换行显示）
  - 特殊情况：`"捐飞蠕动众神灵"`（较长文字，需要动态调整字体大小）
- ✅ **只需**在**左侧**"陽上"和"敬薦"之间叠加：申请人的关系和名字
  - 例如：`"孝女王小小"`（插入到左侧"陽上"和"敬薦"之间）

**实现方式：**
1. 加载 SVG 作为背景图
2. 在中间位置叠加逝者的关系-名字（46px，竖排）
3. 在**左侧**"陽上"下方叠加申请人信息（小字，竖排）

**示例（最终效果）：**
```
        佛力超薦          ← SVG 模板中已有（中间）
陽上    父亲王大明        ← 左侧"陽上"来自SVG，中间"父亲王大明"由代码添加
孝女    往生蓮位          ← 左侧"孝女王小小"由代码添加，中间"往生蓮位"来自SVG
王小小
敬薦                      ← 左侧"敬薦"来自SVG
```

---

### 3. 历代祖先 (Ancestors Tablet)

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件中**已经预先绘制了**：
- ✅ 顶部文字：**"佛力超薦"**（无需代码再次渲染）
- ✅ 中间文字：**"氏歷代祖先往生蓮位"**（9个字，无需代码再次渲染）
- ✅ **左侧**文字：**"陽上後裔"**（上方）+ 空白 + **"叩薦"**（下方）（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**再渲染"佛力超薦"、"氏歷代祖先往生蓮位"、"陽上後裔"、"叩薦"
- ✅ **只需**在"氏"字**前面**插入姓氏
  - 中文：`"李"` → 显示为"李氏歷代祖先往生蓮位"
  - 复姓：`"歐陽"` → 显示为"歐陽氏歷代祖先往生蓮位"
  - 英文：`"Adams"` → 显示为"Adams氏歷代祖先往生蓮位"
- ✅ **只需**在**左侧**"陽上後裔"和"叩薦"之间叠加：申请人名字
  - 例如：`"李四"`（插入到左侧"陽上後裔"和"叩薦"之间）

**实现方式：**
1. 加载 SVG 作为背景图
2. 在"氏"字前方插入姓氏（46px，竖排）
3. 在**左侧**"陽上後裔"下方叠加申请人名字（小字，竖排）

**示例（最终效果）：**
```
            佛力超薦              ← SVG 模板中已有
陽上後裔    李                    ← 左侧"陽上後裔"来自SVG，中间"李"由代码添加
李四        氏歷代祖先往生蓮位    ← 左侧"李四"由代码添加，中间文字来自SVG
叩薦                              ← 左侧"叩薦"来自SVG
```

---

### 4. 冤亲债主 (Karmic Creditors Tablet)

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件中**已经预先绘制了**：
- ✅ 顶部文字：**"佛力超薦"**（无需代码再次渲染）
- ✅ 中间文字：**"累劫冤親債主"**（6个字，固定内容，无需代码再次渲染）
- ✅ 底部文字：**"往生蓮位"**（无需代码再次渲染）
- ✅ **左侧**文字：**"陽上"**（上方）+ 空白 + **"敬薦"**（下方）（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**渲染任何中间内容（"累劫冤親債主"已在模板中，是固定文字）
- ✅ **只需**在**左侧**"陽上"和"敬薦"之间叠加：申请人名字
  - 例如：`"鄭偉"`（插入到左侧"陽上"和"敬薦"之间）

**句式结构：**
```
陽上 [申请人名字] 敬薦
```
完整句子：`陽上 鄭偉 敬薦`

**实现方式：**
1. 加载 SVG 作为背景图（已包含所有固定文字）
2. **仅**在**左侧**"陽上"下方叠加申请人名字（小字，竖排）

**示例（最终效果）：**
```
        佛力超薦              ← SVG 模板中已有
陽上    累劫冤親債主          ← 全部来自 SVG 模板（固定文字）
鄭偉    往生蓮位              ← 左侧"鄭偉"由代码添加，其余来自 SVG
敬薦                          ← 左侧"敬薦"来自 SVG
```

---

### 5. 婴灵排位 (Aborted Spirits Tablet)

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件中**已经预先绘制了**：
- ✅ 顶部文字：**"佛力超薦"**（无需代码再次渲染）
- ✅ 底部文字：**"往生蓮位"**（无需代码再次渲染）
- ✅ **左侧**文字：**"陽上"**（上方）+ 空白 + **"敬薦"**（下方）（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**再渲染"佛力超薦"、"往生蓮位"、"陽上"、"敬薦"
- ✅ **只需**在中间位置叠加：婴灵信息
  - 例如：`"王姓二位嬰靈菩薩"`（用户填写的婴灵描述）
  - 可能较长，需要动态调整字体大小
- ✅ **只需**在**左侧**"陽上"和"敬薦"之间叠加：父母信息（带关系）
  - 格式：`"父 [父亲名字] 母 [母亲名字]"`
  - 例如：`"父 王大明 母 李小花"`

**句式结构：**

中间主体：
```
佛力超薦 [婴灵信息] 往生蓮位
```
完整句子：`佛力超薦 王姓二位嬰靈菩薩 往生蓮位`

左侧申请人：
```
陽上 父[父亲名字]母[母亲名字] 敬薦
```
完整句子：`陽上 父王大明母李小花 敬薦`

**实现方式：**
1. 加载 SVG 作为背景图
2. 在中间位置叠加婴灵信息（46px，竖排，根据长度调整字体）
3. 在**左侧**"陽上"下方叠加父母信息（小字，竖排，格式：父+名字+母+名字）

**示例（最终效果）：**
```
            佛力超薦              ← SVG 模板中已有
陽上        王姓二位嬰靈菩薩      ← 中间由代码添加
父          往生蓮位              ← 左侧"父王大明母李小花"由代码添加，中间"往生蓮位"来自 SVG
王大明
母
李小花
敬薦                              ← 左侧"敬薦"来自 SVG
```

---

### 6. 地基主 (Land Deity Tablet)

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件中**已经预先绘制了**：
- ✅ 顶部文字：**"佛力超薦"**（无需代码再次渲染）
- ✅ 底部文字：**"往生蓮位"**（无需代码再次渲染）
- ✅ **左侧**文字：**"陽上"**（上方）+ 空白 + **"叩薦"**（下方）（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**再渲染"佛力超薦"、"往生蓮位"、"陽上"、"叩薦"
- ✅ **只需**在中间位置叠加：地址 + "之地基主"
  - 用户填写地址，系统自动添加"之地基主"
  - 例如：`"中國福建省福州市蘭花區向陽橋路1009號之地基主"`
  - 注意：地址长度不一（中国、美国等不同国家格式），需要动态调整字体大小
- ✅ **只需**在**左侧**"陽上"和"叩薦"之间叠加：申请人名字
  - 例如：`"王小小"`

**句式结构：**

中间主体：
```
佛力超薦 [地址]之地基主 往生蓮位
```
完整句子：`佛力超薦 中國福建省福州市蘭花區向陽橋路1009號之地基主 往生蓮位`

左侧申请人：
```
陽上 [申请人名字] 叩薦
```
完整句子：`陽上 王小小 叩薦`（使用"叩薦"因为地基主是神灵/长辈）

**实现方式：**
1. 加载 SVG 作为背景图
2. 在中间位置叠加地址+之地基主（46px，竖排，根据长度动态调整字体）
3. 在**左侧**"陽上"下方叠加申请人名字（小字，竖排）

**示例（最终效果）：**
```
            佛力超薦                              ← SVG 模板中已有
陽上        中國福建省福州市蘭花區向陽橋路1009號  ← 中间由代码添加（地址+之地基主）
王小小      之地基主
叩薦        往生蓮位                              ← 左侧"王小小"由代码添加，其余来自 SVG
```

---

## Active Areas (活动区域)

### 什么是活动区域？

**活动区域**是模板中用于插入动态文字的指定区域，由红色虚线框标出边界。这些区域：
- ✅ 提供**定位参考**：明确文字应该放在哪里
- ✅ 提供**对齐基准**：根据区域的中心线来居中文字
- ✅ 提供**边界限制**：文字不能超出红色虚线框

### 各模板的活动区域配置

#### 📋 1个活动区域的模板

##### 1. Longevity (长生禄位)
- **活动区域数量**: 1个
- **中心区域**:
  - 位置：在"佛光注照"（顶部）和"長生祿位"（底部）之间
  - 用途：放置被推荐者的名字
  - 示例：`"伍小群"`, `"伍小群 闔家"`, `"Alice Smith"`

##### 2. Karmic Creditors (冤亲债主)
- **活动区域数量**: 1个
- **左侧区域**:
  - 位置：在"陽上"（上方）和"敬薦"（下方）之间
  - 用途：放置申请人名字
  - 示例：`"累劫冤親債主"`
  - ⚠️ 注意：中心的"累劫冤親債主"是固定文字，**不是活动区域**

#### 📋 2个活动区域的模板

##### 3. Deceased (往生莲位)
- **活动区域数量**: 2个
- **中心区域**:
  - 位置：在"佛力超薦"（顶部）和"往生蓮位"（底部）之间
  - 用途：放置被超荐者的关系和名字
  - 示例：`"父親梁大新"`, `"母親李小花"`
- **左侧区域**:
  - 位置：在"陽上"（上方）和"敬薦"（下方）之间
  - 用途：放置申请人的关系和名字
  - 示例：`"孝女王小小"`, `"Alice Smith"`

##### 4. Ancestors (历代祖先)
- **活动区域数量**: 2个
- **中心区域**:
  - 位置：在"佛力超薦"（顶部）和"氏歷代祖先往生蓮位"附近
  - 用途：在"氏"字**前面**插入姓氏
  - 示例：`"李"` → `"李氏歷代祖先往生蓮位"`
  - 示例：`"歐陽"` → `"歐陽氏歷代祖先往生蓮位"`
- **左侧区域**:
  - 位置：在"陽上後裔"（上方）和"叩薦"（下方）之间
  - 用途：放置申请人名字（仅名字，不含关系）
  - 示例：`"李四"`

##### 5. Aborted Spirits (婴灵排位)
- **活动区域数量**: 2个
- **中心区域**:
  - 位置：在"佛力超薦"（顶部）和"往生蓮位"（底部）之间
  - 用途：放置婴灵描述信息
  - 示例：`"王姓二位嬰靈菩薩"`
- **左侧区域**:
  - 位置：在"陽上"（上方）和"敬薦"（下方）之间
  - 用途：放置父母信息
  - 格式：`"父 [父亲名字] 母 [母亲名字]"`
  - 示例：`"父 王大明 母 李小花"`

##### 6. Land Deity (地基主)
- **活动区域数量**: 2个
- **中心区域**:
  - 位置：在"佛力超薦"（顶部）和"往生蓮位"（底部）之间
  - 用途：放置地址 + "之地基主"
  - 示例：`"中國福建省福州市蘭花區向陽橋路1009號之地基主"`
  - ⚠️ 注意：地址长度不一，需要动态调整字体大小
- **左侧区域**:
  - 位置：在"陽上"（上方）和"叩薦"（下方）之间
  - 用途：放置申请人名字
  - 示例：`"王小小"`

### 布局原则

1. **文字对齐**
   - 所有文字都 **center-aligned**（居中对齐）
   - 在模板自带文字之间的红色虚线框内放置
   - 尽量让文字工整平衡

2. **文字扩展规则**
   - 如果文字较多或较长，可以：
     - 向上下扩展
     - 自动调整字体大小
   - ⚠️ **不要超过红色虚线划出的 active area**

3. **视觉层次**
   - **被超荐者的名字要更突出**（视觉上更显眼）
   - 其他文字（如"陽上"行）相对较小

---

## ⚠️ 关键技术原则 (VERY IMPORTANT)

### 1. 左右居中 vs 上下居中的实现差异

#### 左右居中（水平居中）
- ✅ **实现方式**：在 `route.tsx` 中使用 Flexbox 的 `alignItems: 'center'`
- ✅ **依赖**：活动区域容器的 `width` 属性
- ✅ **优点**：自动居中，不需要手动计算偏移
- ✅ **适用性**：所有模板通用，因为左右边界由华盖和卍字边框框定

```tsx
// route.tsx 中的实现
<div style={{
  display: 'flex',
  flexDirection: 'column',
  alignItems: 'center',      // ← 左右居中靠这个
  justifyContent: 'center',
}}>
```

#### 上下居中（垂直居中）
- ⚠️ **实现方式**：在 `route.tsx` 中使用 Flexbox 的 `justifyContent: 'center'`
- ⚠️ **依赖**：活动区域的 `y`（起始坐标）和 `height`（高度）
- ⚠️ **关键**：`y` 和 `height` 必须精确对应模板上固定文字之间的空间
- ⚠️ **差异**：**不同模板的固定文字位置不同，所以 y 和 height 会不同**

```tsx
// 活动区域配置决定了上下居中的范围
{
  y: 295,        // ← 固定文字下方的起始点
  height: 345,   // ← 到下方固定文字上方的距离
}
```

### 2. SVG 优化后坐标会变化

⚠️ **重要警告**：
- SVG 模板会经过优化（SVGO），优化后所有坐标值都会改变
- **不能依赖硬编码的绝对坐标**
- 必须理解**相对比例关系**

#### 如何正确确定活动区域？

**步骤 1：在设计工具中测量**
```
打开优化后的 SVG（如 long-living-template-optimized.svg）
使用 Figma / Illustrator / 浏览器开发者工具

测量以下值：
1. 上方固定文字（如"佛光注照"）的底部 Y 坐标 = Y_top
2. 下方固定文字（如"長生祿位"）的顶部 Y 坐标 = Y_bottom
3. SVG 总高度 = svgHeight

计算活动区域：
- y = Y_top + 小间距（如 25px，留出呼吸空间）
- height = (Y_bottom - Y_top) - 2×小间距
```

**步骤 2：在配置文件中定义**
```typescript
// lib/active-areas-config.ts
export const LONGEVITY_TEMPLATE_CONFIG: TabletTemplateConfig = {
  svgWidth: 320,
  svgHeight: 848,
  activeAreas: [
    {
      id: 'center',
      x: 45,           // 左右边界（相对固定）
      y: 295,          // ⚠️ 上方固定文字的底部 + 间距
      width: 230,      // 左右边界宽度（相对固定）
      height: 345,     // ⚠️ Y_bottom - y - 间距
      purpose: 'main',
      fontSize: 44,
      lineHeight: 44,
    },
  ],
}
```

**步骤 3：验证和微调**
```bash
# 测试不同长度的名字
http://localhost:3000/api/og/tablet?type=longevity&name=王明           # 2字
http://localhost:3000/api/og/tablet?type=longevity&name=买买提江·熱合曼  # 7字

# 检查点：
✓ 短名字：上下空间是否相等？
✓ 长名字：是否在活动区域内，不与固定文字重叠？
✓ 视觉平衡：整体是否居中？
```

### 3. 不同模板需要不同的 y 和 height

⚠️ **每个模板的配置都不同**，因为：
- "佛光注照" vs "佛力超薦" 的位置不同
- "長生祿位" vs "往生蓮位" 的位置不同
- 华盖装饰的高度可能不同

**示例对比**：
```typescript
// Longevity (长生禄位)
y: 295, height: 345  // "佛光注照" 到 "長生祿位"

// Deceased (往生莲位)
y: 280, height: 360  // "佛力超薦" 到 "往生蓮位"（可能不同！）
```

### 4. 调试技巧

如果活动区域不准确：
1. **上方空间大** → 增大 `y`（向下移动起始点）
2. **下方空间大** → 减小 `y`（向上移动起始点）
3. **上下都重叠** → 减小 `height` 或 `fontSize`
4. **文字太小** → 增大 `height`（扩大可用空间）

**黄金法则**：
```
活动区域的中心点 = (y + height/2)
应该等于
固定文字之间视觉空间的中心点
```

---

## 📐 实战案例：长生禄位活动区域配置流程

### 成功案例记录 (2024-11-22)

以下是我们为 **长生禄位 (Longevity Tablet)** 配置活动区域的完整流程，这个策略虽然比较 manual，但是**成功了**！

#### 步骤 1：导出 SVG 文件

文件位置：
```
/Users/sicongliang/Tablet-system/tablet-system/public/long-living-template-optimized.svg
```

复制到桌面：
```bash
cp /path/to/long-living-template-optimized.svg ~/Desktop/
```

#### 步骤 2：在 Figma 中测量

1. **打开 Figma**，导入 `long-living-template-optimized.svg`
2. **验证 SVG 尺寸**：320 × 848 px ✓
3. **选中上方固定文字**（"佛光注照"）
   - 查看右侧 Position 面板
   - 记录：**底部 Y 坐标 = 306**
4. **选中下方固定文字**（"長生祿位"）
   - 查看右侧 Position 面板  
   - 记录：**顶部 Y 坐标 = 618**

#### 步骤 3：计算活动区域

**理论可用空间**：
```
从 Y=306（"佛光注照"底部）
到 Y=618（"長生祿位"顶部）
总高度 = 618 - 306 = 312px
```

**留出呼吸空间**（padding）：
- 我们选择**上下各留 6px** 的间距
- 这样文字不会紧贴固定文字，视觉更舒适

**最终配置**：
```typescript
{
  y: 306 + 6 = 312,           // 顶部留 6px
  height: 312 - 12 = 300,     // 总高度减去上下各 6px
}
```

验证：
```
顶部边界：Y = 312 (距离"佛光注照"底部 6px) ✓
底部边界：Y = 312 + 300 = 612 (距离"長生祿位"顶部 6px) ✓
```

#### 步骤 4：更新配置文件

编辑 `lib/active-areas-config.ts`：

```typescript
export const LONGEVITY_TEMPLATE_CONFIG: TabletTemplateConfig = {
  templateId: 'longevity',
  svgWidth: 320,
  svgHeight: 848,
  activeAreas: [
    {
      id: 'center',
      // Measured from Figma:
      // "佛光注照" bottom: Y=306
      // "長生祿位" top: Y=618
      // With symmetric 6px padding
      x: 45,           
      y: 312,          // 306 + 6px
      width: 230,      
      height: 300,     // (618 - 6) - (306 + 6) = 300
      purpose: 'main',
      fontSize: 44,
      lineHeight: 44,
    },
  ],
}
```

#### 步骤 5：测试验证

测试不同长度的名字：

| 名字 | 字数 | 测试结果 |
|------|------|---------|
| 王明 | 2字 | ✅ 上下空间对称 |
| 王小明华 | 4字 | ✅ 上下空间对称 |
| 上弘下唯法師 | 6字 | ✅ 上下空间工整 |
| 买买提江·熱合曼 | 7字 | ✅ 很漂亮！字体自动缩小，不重叠 |

**测试 URL**：
```
http://localhost:3000/api/og/tablet?type=longevity&name=王明
http://localhost:3000/api/og/tablet?type=longevity&name=上弘下唯法師
http://localhost:3000/api/og/tablet?type=longevity&name=买买提江·熱合曼
```

#### 关键要点总结

✅ **成功因素**：
1. **精确测量**：使用 Figma 获取准确的 Y 坐标
2. **留出间距**：上下各留 6px，避免文字紧贴
3. **对称设计**：padding 上下相等，视觉平衡
4. **充分测试**：测试 2-7 字的各种长度

⚠️ **注意事项**：
- 每个模板的固定文字位置不同，需要**单独测量**
- SVG 优化后坐标会变，不能硬编码
- 间距大小（6px）可以根据视觉效果调整（建议 3-10px）

---

## 🔄 其他模板配置指南

为其他 5 个模板（往生莲位、历代祖先、冤亲债主、婴灵排位、地基主）配置活动区域时，遵循同样的流程：

1. 导出并在 Figma 中打开对应的 SVG
2. 测量**上方固定文字底部**和**下方固定文字顶部**的 Y 坐标
3. 计算活动区域：`y = Y_top + padding`, `height = (Y_bottom - padding) - (Y_top + padding)`
4. 更新 `lib/active-areas-config.ts` 中对应的配置
5. 测试不同长度的名字，确保上下空间对称

**预期配置差异**：
- "佛力超薦" 的位置可能和 "佛光注照" 不同
- "往生蓮位" 的位置可能和 "長生祿位" 不同
- 左侧活动区域（"陽上"到"敬薦"）需要单独测量

### 快速参考表

| 模板类型 | 活动区域数量 | 中心区域 | 左侧区域 |
|---------|------------|---------|---------|
| Longevity | 1 | ✅ 被推荐者名字 | ❌ |
| Karmic Creditors | 1 | ❌ (固定文字) | ✅ 申请人名字 |
| Deceased | 2 | ✅ 被超荐者信息 | ✅ 申请人信息 |
| Ancestors | 2 | ✅ 姓氏插入 | ✅ 申请人名字 |
| Aborted Spirits | 2 | ✅ 婴灵信息 | ✅ 父母信息 |
| Land Deity | 2 | ✅ 地址+之地基主 | ✅ 申请人名字 |

---

## 字体规格 (Typography Specifications)

### 字体选择
- **中文字体**: `Noto Serif TC`（思源宋体-繁体中文）
  - **原因**：开源、易获取、Satori 友好
  - **备选**：`Kaiti TC`（楷体）如果未来需要更传统的书法风格
  - **注意**：需要使用精简版（subset）以避免文件过大导致 Edge Runtime 超时

### 字体大小和行高

| 文字类型 | 字体大小 | 行高 (Line Height) |
|---------|---------|-------------------|
| **"佛力超薦"** / **"佛光注照"** | 26px | 26px |
| **中间名字**（被超荐者） | 46px | 44px |
| **"陽上"行**（右侧小字） | 较小 | 根据内容调整 |

### 视觉比例
- 在合成中保持类似的视觉效果和比例
- 中间名字应该是最突出的元素

---

## 模板相似性

**重要发现：**
- 五种牌位模板（往生莲位、历代祖先、冤亲债主、婴灵排位、地基主）都比较相似
- 只是嵌入的信息稍微不同
- **长生禄位**也比较相似，只是文字改改
- **上面的图画和背景都是一样的**

这意味着：
- ✅ 可以使用同一个 SVG 模板基础
- ✅ 只需要动态替换文字内容
- ✅ 根据牌位类型调整文字位置和大小

---

## 实现建议

### 1. 模板结构
- ✅ **SVG 模板已包含**：华盖、莲台、卍字边框、顶部/底部固定文字
- ✅ **代码职责**：仅在指定位置叠加动态文字（用户输入的名字）

### 2. 文字渲染（关键理解）
**错误做法 ❌：**
```tsx
// 不要这样做！模板中已有这些文字
<div>佛光注照</div>
<div>{userName}</div>
<div>長生祿位</div>
```

**正确做法 ✅：**
```tsx
// 只渲染用户名字，其余文字来自 SVG 背景
<div style={{
  backgroundImage: 'url(svg-template.svg)',  // 包含所有固定文字
}}>
  <div>{userName}</div>  {/* 仅渲染这一项 */}
</div>
```

### 3. 字体加载
- 在 Satori 的 `ImageResponse` 中配置 `fonts` 参数
- 使用 `Noto Serif TC` 字体（开源、Satori 友好）
- 建议使用精简版（subset）以减小文件大小
- 英文也需要字体配置（如果使用 `fontWeight: bold`）

**推荐字体来源：**
- Google Fonts: `Noto Serif TC`
- 或使用子集化工具（如 `fonttools`）创建精简版

### 4. 颜色处理
- **长生禄位**: 红色背景（预览时显示红色，PDF 打印时用红纸）
- **其他牌位**: 黄色背景（预览时显示黄色，PDF 打印时用黄纸）

---

## 相关文件

- [TDD.md](./TDD.md) - 技术设计文档
- [SATORI_EVALUATION.md](./SATORI_EVALUATION.md) - Satori 评估文档
- [SVGO_OPTIMIZATION.md](./SVGO_OPTIMIZATION.md) - SVG 优化指南

