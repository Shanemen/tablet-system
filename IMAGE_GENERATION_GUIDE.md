# Image Generation and Visual References

## 图案和文字 (Patterns and Text)

### 通用元素 (Common Elements)

每个模板都包含以下装饰元素：
- **华盖 (Canopy)**: 顶部的装饰性华盖图案
- **莲台 (Lotus)**: 底部的莲花台装饰
- **卍字边框 (Swastika Borders)**: 左右两侧各一列垂直排列的卍字符号

### 🔑 核心理解：句式结构 (Sentence Structure)

**重要概念：** 牌位上的文字是**完整的句式**，不是独立的词。

#### 句式模板 1：中间主体（逝者信息）
```
佛力超薦 [逝者关系+名字] 往生蓮位
```
- **固定部分**（SVG 模板提供）：`佛力超薦` + `往生蓮位`
- **变量部分**（代码填充）：`父親梁大新`
- **完整句子**：`佛力超薦 父親梁大新 往生蓮位`

#### 句式模板 2：左侧申请人（平辈/晚辈）
```
陽上 [申请人关系+名字] 敬薦
```
- **固定部分**（SVG 模板提供）：`陽上` + `敬薦`
- **变量部分**（代码填充）：`孝女王小小` 或 `Alice Smith`
- **完整句子**：`陽上孝女王小小敬薦` 或 `陽上 Alice Smith 敬薦`

#### 句式模板 3：左侧申请人（长辈/祖先）
```
陽上後裔 [申请人名字] 叩薦
```
- **固定部分**（SVG 模板提供）：`陽上後裔` + `叩薦`
- **变量部分**（代码填充）：`李明`
- **完整句子**：`陽上後裔 李明 叩薦`

### 文字使用规则 (Text Usage Rules)

- **"叩薦"**: 用于长辈和神灵
  - 例如：对故去的父母、祖父母辈的人
  - 例如：对地基主
  
- **"敬薦"**: 用于平辈或晚辈逝者
  - 例如：对平辈或晚辈逝去的人

---

## 六种牌位类型详细说明

### 1. 长生禄位 (Longevity Tablet) - 最特殊

**特点：**
- ✅ **不需要填写"阳上"行**（因为是给活人立的）
- ✅ **用红色纸打印**（其他所有牌位都用黄纸打印）

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件（`long-living-template-optimized.svg`）中**已经预先绘制了**：
- ✅ 顶部文字：**"佛光注照"**（无需代码再次渲染）
- ✅ 底部文字：**"長生祿位"**（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**再渲染"佛光注照"
- ❌ **不要**再渲染"長生祿位"  
- ✅ **只需**在中间位置叠加用户输入的名字
  - 格式：`"某某某"` 或 `"某某某 阖家"` 或 `"ALICE SMITH"`

**实现方式：**
1. 加载 SVG 作为背景图
2. 在 SVG 上方叠加一层，仅渲染中间的名字
3. 名字规格：46px，line-height 44px，竖排居中

**示例（最终效果）：**
```
佛光注照        ← SVG 模板中已有
  某某某        ← 代码动态添加
長生祿位        ← SVG 模板中已有
```

---

### 2. 往生莲位 (Deceased Tablet)

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件中**已经预先绘制了**：
- ✅ 顶部文字：**"佛力超薦"**（无需代码再次渲染）
- ✅ 底部文字：**"往生蓮位"**（无需代码再次渲染）
- ✅ **左侧**文字：**"陽上"**（上方）+ 空白 + **"敬薦"**（下方）（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**再渲染"佛力超薦"、"往生蓮位"、"陽上"、"敬薦"
- ✅ **只需**在中间位置叠加：申请人填写的"关系-名字"
  - 例如：`"父亲王大明"`（单个逝者）
  - 例如：`"父亲王大明\n母亲李小花"`（多个逝者，换行显示）
  - 特殊情况：`"捐飞蠕动众神灵"`（较长文字，需要动态调整字体大小）
- ✅ **只需**在**左侧**"陽上"和"敬薦"之间叠加：申请人的关系和名字
  - 例如：`"孝女王小小"`（插入到左侧"陽上"和"敬薦"之间）

**实现方式：**
1. 加载 SVG 作为背景图
2. 在中间位置叠加逝者的关系-名字（46px，竖排）
3. 在**左侧**"陽上"下方叠加申请人信息（小字，竖排）

**示例（最终效果）：**
```
        佛力超薦          ← SVG 模板中已有（中间）
陽上    父亲王大明        ← 左侧"陽上"来自SVG，中间"父亲王大明"由代码添加
孝女    往生蓮位          ← 左侧"孝女王小小"由代码添加，中间"往生蓮位"来自SVG
王小小
敬薦                      ← 左侧"敬薦"来自SVG
```

---

### 3. 历代祖先 (Ancestors Tablet)

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件中**已经预先绘制了**：
- ✅ 顶部文字：**"佛力超薦"**（无需代码再次渲染）
- ✅ 中间文字：**"氏歷代祖先往生蓮位"**（9个字，无需代码再次渲染）
- ✅ **左侧**文字：**"陽上後裔"**（上方）+ 空白 + **"叩薦"**（下方）（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**再渲染"佛力超薦"、"氏歷代祖先往生蓮位"、"陽上後裔"、"叩薦"
- ✅ **只需**在"氏"字**前面**插入姓氏
  - 中文：`"李"` → 显示为"李氏歷代祖先往生蓮位"
  - 复姓：`"歐陽"` → 显示为"歐陽氏歷代祖先往生蓮位"
  - 英文：`"Adams"` → 显示为"Adams氏歷代祖先往生蓮位"
- ✅ **只需**在**左侧**"陽上後裔"和"叩薦"之间叠加：申请人名字
  - 例如：`"李四"`（插入到左侧"陽上後裔"和"叩薦"之间）

**实现方式：**
1. 加载 SVG 作为背景图
2. 在"氏"字前方插入姓氏（46px，竖排）
3. 在**左侧**"陽上後裔"下方叠加申请人名字（小字，竖排）

**示例（最终效果）：**
```
            佛力超薦              ← SVG 模板中已有
陽上後裔    李                    ← 左侧"陽上後裔"来自SVG，中间"李"由代码添加
李四        氏歷代祖先往生蓮位    ← 左侧"李四"由代码添加，中间文字来自SVG
叩薦                              ← 左侧"叩薦"来自SVG
```

---

### 4. 冤亲债主 (Karmic Creditors Tablet)

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件中**已经预先绘制了**：
- ✅ 顶部文字：**"佛力超薦"**（无需代码再次渲染）
- ✅ 中间文字：**"累劫冤親債主"**（6个字，固定内容，无需代码再次渲染）
- ✅ 底部文字：**"往生蓮位"**（无需代码再次渲染）
- ✅ **左侧**文字：**"陽上"**（上方）+ 空白 + **"敬薦"**（下方）（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**渲染任何中间内容（"累劫冤親債主"已在模板中，是固定文字）
- ✅ **只需**在**左侧**"陽上"和"敬薦"之间叠加：申请人名字
  - 例如：`"鄭偉"`（插入到左侧"陽上"和"敬薦"之间）

**句式结构：**
```
陽上 [申请人名字] 敬薦
```
完整句子：`陽上 鄭偉 敬薦`

**实现方式：**
1. 加载 SVG 作为背景图（已包含所有固定文字）
2. **仅**在**左侧**"陽上"下方叠加申请人名字（小字，竖排）

**示例（最终效果）：**
```
        佛力超薦              ← SVG 模板中已有
陽上    累劫冤親債主          ← 全部来自 SVG 模板（固定文字）
鄭偉    往生蓮位              ← 左侧"鄭偉"由代码添加，其余来自 SVG
敬薦                          ← 左侧"敬薦"来自 SVG
```

---

### 5. 婴灵排位 (Aborted Spirits Tablet)

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件中**已经预先绘制了**：
- ✅ 顶部文字：**"佛力超薦"**（无需代码再次渲染）
- ✅ 底部文字：**"往生蓮位"**（无需代码再次渲染）
- ✅ **左侧**文字：**"陽上"**（上方）+ 空白 + **"敬薦"**（下方）（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**再渲染"佛力超薦"、"往生蓮位"、"陽上"、"敬薦"
- ✅ **只需**在中间位置叠加：婴灵信息
  - 例如：`"王姓二位嬰靈菩薩"`（用户填写的婴灵描述）
  - 可能较长，需要动态调整字体大小
- ✅ **只需**在**左侧**"陽上"和"敬薦"之间叠加：父母信息（带关系）
  - 格式：`"父 [父亲名字] 母 [母亲名字]"`
  - 例如：`"父 王大明 母 李小花"`

**句式结构：**

中间主体：
```
佛力超薦 [婴灵信息] 往生蓮位
```
完整句子：`佛力超薦 王姓二位嬰靈菩薩 往生蓮位`

左侧申请人：
```
陽上 父[父亲名字]母[母亲名字] 敬薦
```
完整句子：`陽上 父王大明母李小花 敬薦`

**实现方式：**
1. 加载 SVG 作为背景图
2. 在中间位置叠加婴灵信息（46px，竖排，根据长度调整字体）
3. 在**左侧**"陽上"下方叠加父母信息（小字，竖排，格式：父+名字+母+名字）

**示例（最终效果）：**
```
            佛力超薦              ← SVG 模板中已有
陽上        王姓二位嬰靈菩薩      ← 中间由代码添加
父          往生蓮位              ← 左侧"父王大明母李小花"由代码添加，中间"往生蓮位"来自 SVG
王大明
母
李小花
敬薦                              ← 左侧"敬薦"来自 SVG
```

---

### 6. 地基主 (Land Deity Tablet)

**⚠️ 重要：SVG 模板已包含的内容**
SVG 模板文件中**已经预先绘制了**：
- ✅ 顶部文字：**"佛力超薦"**（无需代码再次渲染）
- ✅ 底部文字：**"往生蓮位"**（无需代码再次渲染）
- ✅ **左侧**文字：**"陽上"**（上方）+ 空白 + **"叩薦"**（下方）（无需代码再次渲染）
- ✅ 华盖、莲台、卍字边框装饰

**🎯 代码需要做的：**
- ❌ **不要**再渲染"佛力超薦"、"往生蓮位"、"陽上"、"叩薦"
- ✅ **只需**在中间位置叠加：地址 + "之地基主"
  - 用户填写地址，系统自动添加"之地基主"
  - 例如：`"中國福建省福州市蘭花區向陽橋路1009號之地基主"`
  - 注意：地址长度不一（中国、美国等不同国家格式），需要动态调整字体大小
- ✅ **只需**在**左侧**"陽上"和"叩薦"之间叠加：申请人名字
  - 例如：`"王小小"`

**句式结构：**

中间主体：
```
佛力超薦 [地址]之地基主 往生蓮位
```
完整句子：`佛力超薦 中國福建省福州市蘭花區向陽橋路1009號之地基主 往生蓮位`

左侧申请人：
```
陽上 [申请人名字] 叩薦
```
完整句子：`陽上 王小小 叩薦`（使用"叩薦"因为地基主是神灵/长辈）

**实现方式：**
1. 加载 SVG 作为背景图
2. 在中间位置叠加地址+之地基主（46px，竖排，根据长度动态调整字体）
3. 在**左侧**"陽上"下方叠加申请人名字（小字，竖排）

**示例（最终效果）：**
```
            佛力超薦                              ← SVG 模板中已有
陽上        中國福建省福州市蘭花區向陽橋路1009號  ← 中间由代码添加（地址+之地基主）
王小小      之地基主
叩薦        往生蓮位                              ← 左侧"王小小"由代码添加，其余来自 SVG
```

---

## Active Areas (活动区域)

### 布局原则

1. **文字对齐**
   - 所有文字都 **center-aligned**（居中对齐）
   - 在模板自带文字之间的红色虚线框内放置
   - 尽量让文字工整平衡

2. **文字扩展规则**
   - 如果文字较多或较长，可以：
     - 向上下扩展
     - 自动调整字体大小
   - ⚠️ **不要超过红色虚线划出的 active area**

3. **视觉层次**
   - **被超荐者的名字要更突出**（视觉上更显眼）
   - 其他文字（如"陽上"行）相对较小

---

## 字体规格 (Typography Specifications)

### 字体选择
- **中文字体**: `Noto Serif TC`（思源宋体-繁体中文）
  - **原因**：开源、易获取、Satori 友好
  - **备选**：`Kaiti TC`（楷体）如果未来需要更传统的书法风格
  - **注意**：需要使用精简版（subset）以避免文件过大导致 Edge Runtime 超时

### 字体大小和行高

| 文字类型 | 字体大小 | 行高 (Line Height) |
|---------|---------|-------------------|
| **"佛力超薦"** / **"佛光注照"** | 26px | 26px |
| **中间名字**（被超荐者） | 46px | 44px |
| **"陽上"行**（右侧小字） | 较小 | 根据内容调整 |

### 视觉比例
- 在合成中保持类似的视觉效果和比例
- 中间名字应该是最突出的元素

---

## 模板相似性

**重要发现：**
- 五种牌位模板（往生莲位、历代祖先、冤亲债主、婴灵排位、地基主）都比较相似
- 只是嵌入的信息稍微不同
- **长生禄位**也比较相似，只是文字改改
- **上面的图画和背景都是一样的**

这意味着：
- ✅ 可以使用同一个 SVG 模板基础
- ✅ 只需要动态替换文字内容
- ✅ 根据牌位类型调整文字位置和大小

---

## 实现建议

### 1. 模板结构
- ✅ **SVG 模板已包含**：华盖、莲台、卍字边框、顶部/底部固定文字
- ✅ **代码职责**：仅在指定位置叠加动态文字（用户输入的名字）

### 2. 文字渲染（关键理解）
**错误做法 ❌：**
```tsx
// 不要这样做！模板中已有这些文字
<div>佛光注照</div>
<div>{userName}</div>
<div>長生祿位</div>
```

**正确做法 ✅：**
```tsx
// 只渲染用户名字，其余文字来自 SVG 背景
<div style={{
  backgroundImage: 'url(svg-template.svg)',  // 包含所有固定文字
}}>
  <div>{userName}</div>  {/* 仅渲染这一项 */}
</div>
```

### 3. 字体加载
- 在 Satori 的 `ImageResponse` 中配置 `fonts` 参数
- 使用 `Noto Serif TC` 字体（开源、Satori 友好）
- 建议使用精简版（subset）以减小文件大小
- 英文也需要字体配置（如果使用 `fontWeight: bold`）

**推荐字体来源：**
- Google Fonts: `Noto Serif TC`
- 或使用子集化工具（如 `fonttools`）创建精简版

### 4. 颜色处理
- **长生禄位**: 红色背景（预览时显示红色，PDF 打印时用红纸）
- **其他牌位**: 黄色背景（预览时显示黄色，PDF 打印时用黄纸）

---

## 相关文件

- [TDD.md](./TDD.md) - 技术设计文档
- [SATORI_EVALUATION.md](./SATORI_EVALUATION.md) - Satori 评估文档
- [SVGO_OPTIMIZATION.md](./SVGO_OPTIMIZATION.md) - SVG 优化指南

